{% extends 'base/base.html' %}
{% block title %}Dashboard Network{% endblock %}
{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/graphs.css') }}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
{% endblock %}
{% block content %}
{% include 'components/refresh_button.html' %}
<div class="container">
    <h2><i class="fas fa-microchip"></i> CPU Usage Over Time</h2>
    <canvas id="cpuTimeChart"></canvas>
</div>

<div class="container">
    <h2><i class="fas fa-memory"></i> Memory Usage Over Time</h2>
    <canvas id="memoryTimeChart"></canvas>
</div>

<div class="container">
    <h2><i class="fas fa-battery-half"></i> Battery Percentage Over Time</h2>
    <canvas id="batteryTimeChart"></canvas>
</div>

<div class="container">
    <h2><i class="fas fa-network-wired"></i> Network Sent & Received Over Time</h2>
    <canvas id="networkTimeChart"></canvas>
</div>

<div class="container">
    <button id="refresh"><i class="fas fa-sync-alt"></i> Refresh Data</button>
</div>

<script>
    // Get data from Jinja
    const cpuData = {{ cpu | tojson }};
    const timeData = {{ time | tojson | safe }};
    const memoryData = {{ memory | tojson }};
    const batteryData = {{ battery | tojson }};
    const networkSentData = {{ network_sent | tojson }};
    const networkReceivedData = {{ network_received | tojson }};

    // CPU Usage Chart
    const ctxCpu = document.getElementById('cpuTimeChart').getContext('2d');
    const cpuTimeChart = new Chart(ctxCpu, {
        type: 'line',
        data: {
            labels: timeData,
            datasets: [{
                label: 'CPU Usage (%)',
                data: cpuData,
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            scales: {
                x: { title: { display: true, text: 'Time' } },
                y: { beginAtZero: true, title: { display: true, text: 'CPU Usage (%)' } }
            }
        }
    });

    // Memory Usage Chart
    const ctxMemory = document.getElementById('memoryTimeChart').getContext('2d');
    const memoryTimeChart = new Chart(ctxMemory, {
        type: 'line',
        data: {
            labels: timeData,
            datasets: [{
                label: 'Memory Usage (%)',
                data: memoryData,
                borderColor: 'rgba(153, 102, 255, 1)',
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            scales: {
                x: { title: { display: true, text: 'Time' } },
                y: { beginAtZero: true, title: { display: true, text: 'Memory Usage (%)' } }
            }
        }
    });

    // Battery Percentage Chart
    const ctxBattery = document.getElementById('batteryTimeChart').getContext('2d');
    const batteryTimeChart = new Chart(ctxBattery, {
        type: 'line',
        data: {
            labels: timeData,
            datasets: [{
                label: 'Battery Percentage (%)',
                data: batteryData,
                borderColor: 'rgba(255, 159, 64, 1)',
                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            scales: {
                x: { title: { display: true, text: 'Time' } },
                y: { beginAtZero: true, title: { display: true, text: 'Battery Percentage (%)' } }
            }
        }
    });

    // Network Sent & Received Chart
    const ctxNetwork = document.getElementById('networkTimeChart').getContext('2d');
    const networkTimeChart = new Chart(ctxNetwork, {
        type: 'line',
        data: {
            labels: timeData,
            datasets: [
                {
                    label: 'Network Sent (MB)',
                    data: networkSentData,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    fill: true,
                    tension: 0.4
                },
                {
                    label: 'Network Received (MB)',
                    data: networkReceivedData,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    fill: true,
                    tension: 0.4
                }
            ]
        },
        options: {
            scales: {
                x: { title: { display: true, text: 'Time' } },
                y: { beginAtZero: true, title: { display: true, text: 'Data Transferred (MB)' } }
            }
        }
    });

    // Refresh button interaction
    document.getElementById('refresh').addEventListener('click', () => {
        location.reload();
    });
</script>
{% include 'components/refresh_button_script.html' %}
{% endblock %}
